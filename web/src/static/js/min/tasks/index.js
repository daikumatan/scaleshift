var jobs=[],conditions={firstLoad:!0,words:"",order:1},vue=new Vue({el:"#data",data:{jobs:[]},methods:{update:function(){var s=[];$.map(jobs,function(e){(""==conditions.words||app.match([e.image,e.id,e.ipynb,e.status,e.platform],conditions.words))&&s.push(e)}),s.sort(function(e,s){if(1==conditions.order){var a=statusOrder(e.status)-statusOrder(s.status);if(0!=a)return a}return 0!=(a=new Date(s.started).getTime()-new Date(e.started).getTime())?a:statusOrder(e.status)-statusOrder(s.status)});var t=[];$.map(s,function(e){var s=0<e.mounts.length?e.mounts[0]:"";0<s.length&&(s='<a href="/workspaces/?q='+encodeURIComponent(s)+'">'+s+"</a>");var a="-";0!=e.ended.indexOf("0001-01-01")&&(a=app.date.format(new Date(e.ended))),t.push({id:e.id,platform:e.platform,image:e.image,imageHref:'<a href="/images/?q='+encodeURIComponent(e.image)+'">'+e.image+"</a>",commands:e.commands.join(" "),mounts:s,status:statusValue(e.status),statusMore:statusMore(e.status),link:e.external_link?e.external_link:"",started:app.date.format(new Date(e.started)),ended:a,classObject:statusClass(e.status)})}),this.jobs=t,conditions.firstLoad&&(conditions.firstLoad=!1,""!=conditions.words&&0<t.length&&setTimeout(function(){$("#data .collapsible .row-body").eq(0).collapse("show"),$("#query-words").focus()},750)),$("#record-count").text(t.length)},result:function(e){window.location.href="/results/?id="+app.trim($(e.target).closest("li").attr("data-id"))},stop:function(e){confirmation.action="STOP",confirmation.id=app.trim($(e.target).closest("li").attr("data-id")),$("#job-modify").modal("open")},del:function(e){confirmation.action="REMOVE",confirmation.id=app.trim($(e.target).closest("li").attr("data-id")),$("#job-modify").modal("open")}}});function statusValue(e){switch(e){case"building-job":return"preparing";case"pushing-job":case"k8s-job":case"rescale-send":return"sending";case"k8s-job-start":case"k8s-job-pending":case"k8s-job-runnning":case"rescale-start":case"rescale-runnning":return"running";case"k8s-job-succeeded":case"k8s-job-failed":case"rescale-succeeded":case"rescale-failed":return"done"}return"unknown"}function statusMore(e){switch(e){case"building-job":return"Building a docker/singularity image for the job";case"pushing-job":case"k8s-job":case"rescale-send":return"Sending files to the cloud";case"k8s-job-start":case"k8s-job-pending":return"The job is still pending";case"k8s-job-runnning":case"rescale-start":case"rescale-runnning":return"Running the job on the cloud";case"k8s-job-succeeded":case"rescale-succeeded":return"Done (succeeded)";case"k8s-job-failed":case"rescale-failed":return"Done (failed)"}return"unknown"}function statusOrder(e){switch(e){case"building-job":return 1;case"pushing-job":case"k8s-job":case"rescale-send":return 2;case"k8s-job-start":case"k8s-job-pending":return 3;case"k8s-job-runnning":case"rescale-start":case"rescale-runnning":return 4;case"k8s-job-succeeded":case"k8s-job-failed":case"rescale-succeeded":case"rescale-failed":return 5}return 9}function statusClass(e){switch(e){case"building-job":return{"label-info":!0,"label-warning":!1,"label-success":!1,"label-danger":!1};case"pushing-job":case"k8s-job":case"rescale-send":return{"label-info":!1,"label-warning":!0,"label-success":!1,"label-danger":!1};case"k8s-job-start":case"k8s-job-pending":case"k8s-job-runnning":case"rescale-start":case"rescale-runnning":return{"label-info":!1,"label-warning":!1,"label-success":!0,"label-danger":!1};case"k8s-job-succeeded":case"k8s-job-failed":case"rescale-succeeded":case"rescale-failed":return{"label-info":!1,"label-warning":!1,"label-success":!1,"label-danger":!0}}return{"label-info":!1,"label-warning":!1,"label-success":!1,"label-danger":!0}}var confirmation=new Vue({el:"#job-modify",data:{action:"REMOVE",id:""},methods:{exec:function(){switch($("#job-modify").modal("close"),this.action){case"STOP":var e=models.JobAttrs1.constructFromObject({status:"stopped"});API("Job").modifyJob(this.id,e,function(e,s,a){if(!$.isEmptyObject(e)){var t="Could not stop the specified job";return a&&a.body&&a.body.message&&(t=a.body.message),void M.toast({html:t,displayLength:3e3})}M.toast({html:"Stopped successfully. [ "+confirmation.id+" ]",displayLength:3e3}),load()});break;case"REMOVE":API("Job").deleteJob(this.id,function(e,s,a){if(!$.isEmptyObject(e)){var t="Could not remove the specified job";return a&&a.body&&a.body.message&&(t=a.body.message),void M.toast({html:t,displayLength:3e3})}M.toast({html:"Removed successfully. [ "+confirmation.id+" ]",displayLength:3e3}),load()})}},close:function(){$("#job-modify").modal("close")}}});function update(){conditions.words=app.singleSpace($("#query-words").val()),conditions.order=parseInt($("#query-order-type").val(),10),vue.update()}function load(t){API("Job").getJobs(function(e,s,a){$.isEmptyObject(e)&&a&&a.body&&(jobs=a.body,update(),t&&t())})}$(document).ready(function(){$("#menu-tasks").addClass("active"),app.query("q")&&$("#query-words").val(app.query("q")).focus(),load(function(){$("#query-words").keyup(function(){update()}),$("#query-order-type").change(function(){update()}),$("#data").fadeIn()}),setInterval(load,15e3)});