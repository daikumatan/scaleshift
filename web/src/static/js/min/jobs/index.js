var jobs=[],conditions={firstLoad:!0,words:"",order:1},vue=new Vue({el:"#data",data:{jobs:[]},methods:{update:function(){var t=[];$.map(jobs,function(e){(""==conditions.words||app.match([e.image,e.id,e.ipynb,e.status],conditions.words))&&t.push(e)}),t.sort(function(e,t){if(1==conditions.order){var a=statusOrder(e.status)-statusOrder(t.status);if(0!=a)return a}return 0!=(a=new Date(t.started).getTime()-new Date(e.started).getTime())?a:statusOrder(e.status)-statusOrder(t.status)});var a=[];$.map(t,function(e){var t=0<e.mounts.length?e.mounts[0]:"";0<t.length&&(t='<a href="/workspaces/?q='+encodeURIComponent(t)+'">'+t+"</a>"),a.push({id:e.id,image:e.image,imageHref:'<a href="/images/?q='+encodeURIComponent(e.image)+'">'+e.image+"</a>",commands:e.commands.join(" "),mounts:t,status:statusValue(e.status),statusMore:statusMore(e.status),started:app.date.format(new Date(e.started)),classObject:statusClass(e.status)})}),this.jobs=a,conditions.firstLoad&&(conditions.firstLoad=!1,""!=conditions.words&&0<a.length&&setTimeout(function(){$("#data .collapsible .row-body").eq(0).collapse("show"),$("#query-words").blur()},500)),$("#record-count").text(a.length)},del:function(e){confirmation.action="REMOVE",confirmation.id=app.trim($(e.target).closest("li").attr("data-id")),$("#job-modify").modal("open")}}});function statusValue(e){switch(e){case"singularity":return"preparing";case"rescale-send":return"sending";case"rescale-start":return"running";case"rescale-end":return"done"}return"unknown"}function statusMore(e){switch(e){case"singularity":return"Converting the docker image to singularity";case"rescale-send":return"Sending files to the cloud";case"rescale-start":return"Running on the cloud";case"rescale-end":return"Done"}return"unknown"}function statusOrder(e){switch(e){case"singularity":return 1;case"rescale-send":return 2;case"rescale-start":return 3;case"rescale-end":return 4}return 9}function statusClass(e){switch(e){case"singularity":return{"label-info":!0,"label-warning":!1,"label-success":!1,"label-danger":!1};case"rescale-send":return{"label-info":!1,"label-warning":!0,"label-success":!1,"label-danger":!1};case"rescale-start":return{"label-info":!1,"label-warning":!1,"label-success":!0,"label-danger":!1};case"rescale-end":return{"label-info":!1,"label-warning":!1,"label-success":!1,"label-danger":!0}}return{"label-info":!1,"label-warning":!1,"label-success":!1,"label-danger":!0}}var confirmation=new Vue({el:"#job-modify",data:{action:"REMOVE",id:""},methods:{exec:function(){switch($("#job-modify").modal("close"),this.action){case"REMOVE":API("Job").deleteJob(this.id,function(e,t,a){if(!$.isEmptyObject(e)){var s="Could not remove the specified job";return a&&a.body&&a.body.message&&(s=a.body.message),void M.toast({html:s,displayLength:3e3})}M.toast({html:"Removed successfully. [ "+confirmation.id+" ]",displayLength:3e3}),load()})}},close:function(){$("#job-modify").modal("close")}}});function update(){conditions.words=app.singleSpace($("#query-words").val()),conditions.order=parseInt($("#query-order-type").val(),10),vue.update()}function load(s){API("Job").getJobs(function(e,t,a){$.isEmptyObject(e)&&a&&a.body&&(jobs=a.body,update(),s&&s())})}$(document).ready(function(){$("#menu-jobs").addClass("active"),app.query("q")&&$("#query-words").val(app.query("q")).focus(),load(function(){$("#query-words").keyup(function(){update()}),$("#query-order-type").change(function(){update()}),$("#data").fadeIn()}),setInterval(load,15e3)});